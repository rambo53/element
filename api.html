<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

</head>

<body >

    <div>
            <label>code postal : </label>
                <input type="number" id="cp"><br>

            <label>Ville : </label>
                <select id="ville_select">
                    <option value="">--Ville--</option>  
                    
                </select><br>

            <label>adresse : </label>
                <input type="text" id="adresse"><br>

            <p id="propo"></p>

            <p id="ville"></p> 
    </div>


</body>

<script>


    var cp = document.getElementById("cp");
    cp.addEventListener("input", affiche);

    function affiche(){
        let cpValue = cp.value;

        if(cpValue.length===5){

            fetch('https://geo.api.gouv.fr/communes?codePostal='+cpValue, {method: 'GET'})
                .then(data => data.json())
                .then(data=> {  

                    let villePara = document.getElementById('ville_select');
                    villePara.innerHTML='<option value="">--Ville--</option> ';

                        data.map(ville =>{
                            villePara.innerHTML += "<option value="+ville.nom+">"+ville.nom+"</option>";
                        })
                });      
            
        }
    }

    //////////////////////////////////////////////////////////////////////////

    var adresse = document.getElementById("adresse");
    adresse.addEventListener("input", verif);

    function verif(){
        
        let adresseValide = adresse.value;

        if(adresseValide.length>1){
        
            fetch("https://api-adresse.data.gouv.fr/search/?q="+adresseValide+"&postcode="+cp.value, {method: 'GET'})
                .then(data => data.json())
                .then(data=> {  

                    let propo=document.getElementById('propo');
                    propo.innerHTML='';
                    let propoAdresse=data.features;
                    let i=0;

                        propoAdresse.map(ville =>{
                            propo.innerHTML += "<input class='radio_select' type='radio' id="+i+" name='rue'><label for="+i+">"
                                +ville.properties.name+"</label><br> - longitude : "
                                +ville.geometry.coordinates[0]+"<br> - latitude : "
                                +ville.geometry.coordinates[1]+"<br>";

                                document.getElementById(i).value=ville.properties.name;

                                i++;
                })
            });
        }
    }

    ////////////////////////////////////////////////////////////////////////////

    

</script>

</html>
